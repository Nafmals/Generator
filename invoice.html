<!DOCTYPE html>
<html lang="en" dir="ltr" data-theme="navy-dark">
<head>
<meta charset="UTF-8">
<title>Nafithat – Advanced Invoice Manager (Local)</title>

<style>
/* ================== (CSS لم يتم تغييره) ================== */
* { box-sizing:border-box; }
/* جميع الستايل كما هو عندك */
</style>
</head>

<body>

<!-- ================== TOPBAR ================== -->
<div class="topbar">
  <div class="brand">
    <div class="brand-title">Nafithat Al-Amal Co.</div>
    <div class="brand-sub">Advanced Invoice Management (Local)</div>
  </div>
</div>

<main style="max-width:1350px;margin:auto">

<!-- ================== DASHBOARD ================== -->
<section id="dashboard" class="card">

<table>
<thead>
<tr>
  <th>Date</th>
  <th>Due Date</th>
  <th>Invoice No</th>
  <th>Contract (PO)</th>
  <th>Customer</th>
  <th>DESCRIPTION</th>
  <th>Status</th>
  <th>Amount</th>
  <th>Actions</th>
</tr>
</thead>
<tbody id="invoice-table-body"></tbody>
</table>

</section>
</main>

<script>
/* ================== DATA ================== */
let invoices = [];

/* ================== HELPERS ================== */
function formatIQD(num){
  return "IQD " + Number(num||0).toLocaleString("en-US");
}
function isOverdue(inv){
  if(inv.status==="paid" || !inv.dueDate) return false;
  return new Date(inv.dueDate) < new Date();
}
function getStatusBadge(inv){
  if(inv.status==="paid") return '<span class="badge badge-paid">Paid</span>';
  if(isOverdue(inv)) return '<span class="badge badge-overdue">Overdue</span>';
  return '<span class="badge badge-unpaid">Unpaid</span>';
}

/* ================== RENDER DASHBOARD ================== */
function renderDashboard(){
  const tbody = document.getElementById("invoice-table-body");
  tbody.innerHTML = "";

  invoices.forEach(inv => {

    /* ✅ DESCRIPTION FIX (الحل الأساسي) */
    const description =
      inv.scope
        ? inv.scope
        : (inv.items && inv.items.length && inv.items[0].desc
            ? inv.items[0].desc
            : "-");

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${inv.issueDate || ""}</td>
      <td>${inv.dueDate || ""}</td>
      <td>${inv.number || ""}</td>
      <td>${inv.contract || ""}</td>
      <td>${inv.customerName || ""}</td>
      <td class="text-muted">${description}</td>
      <td>${getStatusBadge(inv)}</td>
      <td>${formatIQD(inv.balance)}</td>
      <td>
        <button>Edit</button>
        <button>Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

/* ================== SAMPLE DATA (للتجربة فقط) ================== */
invoices = [
  {
    number:"CP-INV0001",
    issueDate:"2024-03-01",
    dueDate:"2024-03-31",
    contract:"PO00023",
    customerName:"Customer A",
    scope:"Fuel supply for March",
    balance:5500000,
    status:"paid",
    items:[]
  },
  {
    number:"CP-INV0002",
    issueDate:"2024-03-05",
    dueDate:"2024-03-31",
    contract:"PO00023",
    customerName:"Customer A",
    scope:"",
    balance:2167500,
    status:"paid",
    items:[
      { desc:"Diesel fuel – liters" }
    ]
  }
];

/* ================== INIT ================== */
renderDashboard();
</script>

</body>
</html>
