function setupEvents(){

  // helper: add listener only if element exists
  function on(id, evt, handler){
    const el = $(id);
    if(el) el.addEventListener(evt, handler);
  }

  on("tab-dashboard","click",showDashboard);
  on("tab-report","click",showReport);

  on("btn-new","click",createNewInvoice);
  on("btn-save","click",saveCurrentInvoice);
  on("btn-back","click",showDashboard);
  on("btn-print","click",()=>window.print());
  on("btn-delete","click",deleteCurrentInvoice);

  on("btn-export","click",exportCsv);
  on("btn-save-json","click",exportJson);
  on("btn-reset","click",resetSystem);

  on("btn-load-json","click",()=>$("json-file-input") && $("json-file-input").click());

  const fileInput = $("json-file-input");
  if(fileInput){
    fileInput.addEventListener("change", e=>{
      const file=e.target.files[0];
      if(file) importJsonFromFile(file);
      e.target.value="";
    });
  }

  // status pills
  document.querySelectorAll(".status-pill").forEach(btn=>{
    btn.addEventListener("click",()=>{
      document.querySelectorAll(".status-pill").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      currentFilter = btn.dataset.filter;
      specialFilter = "none";
      document.querySelectorAll(".stat-card").forEach(c=>c.classList.remove("active"));
      const totalCard = document.querySelector('.stat-card[data-type="total"]');
      if(totalCard && currentFilter==="all") totalCard.classList.add("active");
      renderDashboard();
    });
  });

  // stat cards as filters
  document.querySelectorAll(".stat-card").forEach(card=>{
    card.addEventListener("click",()=>{
      document.querySelectorAll(".stat-card").forEach(c=>c.classList.remove("active"));
      card.classList.add("active");

      const t = card.dataset.type;
      specialFilter = "none";

      if(t === "paid"){
        currentFilter = "paid";
      } else if(t === "unpaid"){
        currentFilter = "unpaid";
      } else if(t === "due-soon"){
        currentFilter = "all";
        specialFilter = "due-soon";
      } else {
        currentFilter = "all";
      }

      document.querySelectorAll(".status-pill").forEach(b=>b.classList.remove("active"));
      const pill = document.querySelector(`.status-pill[data-filter="${currentFilter}"]`)
            || document.querySelector(`.status-pill[data-filter="all"]`);
      if(pill) pill.classList.add("active");

      renderDashboard();
    });
  });

  on("po-filter","change", e=>{
    currentPoFilter = e.target.value;
    renderDashboard();
  });

  on("search-input","input", e=>{
    searchTerm = e.target.value.trim();
    renderDashboard();
  });

  // âœ… NEW: Issue Date filters (won't crash if inputs not present)
  on("date-from","change", e=>{
    dateFrom = e.target.value || "";
    renderDashboard();
  });
  on("date-to","change", e=>{
    dateTo = e.target.value || "";
    renderDashboard();
  });

  on("btn-add-row","click", ()=>{
    const row=createItemRow();
    const body = $("items-body");
    if(body){
      body.appendChild(row);
      updateRowNumbers();
      recalcTotals();
    }
  });

  on("f-discount","input",recalcTotals);
  on("f-tax","input",recalcTotals);
  on("f-shipping","input",recalcTotals);

  // sort headers
  document.querySelectorAll("th.sortable").forEach(th=>{
    th.addEventListener("click", ()=>{
      const field = th.dataset.sort;
      if(sortField === field){
        sortDir = (sortDir === "asc") ? "desc" : "asc";
      } else {
        sortField = field;
        sortDir = "asc";
      }
      renderDashboard();
    });
  });

  on("theme-select","change", e => applyTheme(e.target.value));

  window.editInvoice=editInvoice;
  window.deleteInvoiceById=deleteInvoiceById;
}
