// import_invoices.js
// سكربت واحد يقوم بـ:
// 1) حفظ بيانات الفواتير في ملف JSON
// 2) إنشاء قاعدة بيانات SQLite وجدول invoices
// 3) استيراد الفواتير إلى الجدول
// 4) حساب مجموع المبالغ المدفوعة وغير المدفوعة

const fs = require('fs');
const path = require('path');
const sqlite3 = require('sqlite3').verbose();

// =======================
// 1) بيانات الفواتير
// =======================

const invoices = [
  {
    po: "PO00023",
    invoice_no: "CP-INV00001",
    date: "Mar-24",
    description: "Generator rental: 200KVA, including operators available 24/7 and a 3000-liter fuel tank.",
    duration_from: "01-Mar-24",
    duration_to: "31-Mar-24",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 5,500,000",
    total: "IQD 5,500,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00001",
    date: "Mar-24",
    description: "Generator rental: 200KVA, including operators available 24/7 and a 3000-liter fuel tank.",
    duration_from: "01-Apr-24",
    duration_to: "30-Apr-24",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 5,500,000",
    total: "IQD 5,500,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00003",
    date: "May-24",
    description: "Generator rental: 200KVA, including operators available 24/7 and a 3000-liter fuel tank.",
    duration_from: "01-May-24",
    duration_to: "31-May-24",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 5,500,000",
    total: "IQD 5,500,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00004",
    date: "Jun-24",
    description: "Generator rental: 200KVA, including operators available 24/7 and a 3000-liter fuel tank.",
    duration_from: "01-Jun-24",
    duration_to: "30-Jun-24",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 5,500,000",
    total: "IQD 5,500,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00005",
    date: "Jul-24",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Jul-24",
    duration_to: "31-Jul-24",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00006",
    date: "Jul-24",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Aug-24",
    duration_to: "31-Aug-24",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00009",
    date: "Sep-24",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Sep-24",
    duration_to: "30-Sep-24",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00010",
    date: "Oct-24",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Oct-24",
    duration_to: "30-Oct-24",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00012",
    date: "Dec-24",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Nov-24",
    duration_to: "30-Nov-24",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00012",
    date: "Dec-24",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Dec-24",
    duration_to: "31-Dec-24",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00013",
    date: "Jan-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Jan-25",
    duration_to: "31-Jan-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00015",
    date: "Feb-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Feb-25",
    duration_to: "28-Feb-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00015",
    date: "Mar-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Mar-25",
    duration_to: "31-Mar-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00016",
    date: "Apr-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Apr-25",
    duration_to: "30-Apr-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Unpaid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00016",
    date: "May-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-May-25",
    duration_to: "31-May-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Unpaid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00018",
    date: "Jun-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Jun-25",
    duration_to: "30-Jun-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Unpaid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00018",
    date: "Jul-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Jul-25",
    duration_to: "31-Jul-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 6,750,000",
    total: "IQD 6,750,000",
    status: "Unpaid"
  },
  {
    po: "4400013837",
    invoice_no: "NA-2025-INV00024",
    date: "Aug-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Aug-25",
    duration_to: "31-Aug-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 8,650,000",
    total: "IQD 8,650,000",
    status: "Paid"
  },
  {
    po: "4400013837",
    invoice_no: "NA-2025-INV00026",
    date: "Sep-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Sep-25",
    duration_to: "30-Sep-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 8,650,000",
    total: "IQD 8,650,000",
    status: "Paid"
  },
  {
    po: "4400013837",
    invoice_no: "NA-2025-INV00031",
    date: "Oct-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Oct-25",
    duration_to: "31-Oct-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 8,650,000",
    total: "IQD 8,650,000",
    status: "Paid"
  },
  {
    po: "4400013837",
    invoice_no: "NA-2025-INV00036",
    date: "Nov-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Nov-25",
    duration_to: "30-Nov-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 8,650,000",
    total: "IQD 8,650,000",
    status: "Unpaid"
  },
  {
    po: "4400013837",
    invoice_no: "NA-2025-D-INV00039",
    date: "Dec-25",
    description: "Rental of 2 Electric Power Generation : 200 KVA and 150 KVA, including 24/7 operator availability, 1 ATS, and a 3000-liter fuel tank.",
    duration_from: "01-Dec-25",
    duration_to: "31-Dec-25",
    unit: "Lot",
    qty: 2,
    invoice_amount: "IQD 8,650,000",
    total: "IQD 8,650,000",
    status: "Unpaid"
  },
  {
    po: "4400013503",
    invoice_no: "CP-INV-D-00001",
    date: "Mar-24",
    description: "Generators rental: 2x 150KVA, including operators available 24/7 and a 5000-liter fuel tank.",
    duration_from: "01-Feb-25",
    duration_to: "28-Feb-25",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 12,000,000",
    total: "IQD 12,000,000",
    status: "Paid"
  },
  {
    po: "4400013503",
    invoice_no: "CP-INV-D-00002",
    date: "Mar-25",
    description: "Generators rental: 2x 150KVA, including operators available 24/7 and a 5000-liter fuel tank.",
    duration_from: "01-Mar-25",
    duration_to: "31-Mar-25",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 12,000,000",
    total: "IQD 12,000,000",
    status: "Paid"
  },
  {
    po: "4400013503",
    invoice_no: "CP-INV-D-00003",
    date: "Apr-25",
    description: "Generators rental: 2x 150KVA, including operators available 24/7 and a 5000-liter fuel tank.",
    duration_from: "01-Apr-25",
    duration_to: "30-Apr-25",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 12,000,000",
    total: "IQD 12,000,000",
    status: "Paid"
  },
  {
    po: "4400013503",
    invoice_no: "CP-INV-D-00004",
    date: "Aug-25",
    description: "Generators rental: 2x 150KVA, including operators available 24/7 and a 5000-liter fuel tank.",
    duration_from: "01-Aug-25",
    duration_to: "31-Aug-25",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 12,000,000",
    total: "IQD 12,000,000",
    status: "Unpaid"
  },
  {
    po: "4400013503",
    invoice_no: "CP-INV-D-00005",
    date: "Sep-25",
    description: "Generators rental: 2x 150KVA, including operators available 24/7 and a 5000-liter fuel tank.",
    duration_from: "01-Sep-25",
    duration_to: "30-Sep-25",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 12,000,000",
    total: "IQD 12,000,000",
    status: "Unpaid"
  },
  {
    po: "4400013503",
    invoice_no: "CP-INV-D-00006",
    date: "Oct-25",
    description: "Generators rental: 2x 150KVA, including operators available 24/7 and a 5000-liter fuel tank.",
    duration_from: "01-Oct-25",
    duration_to: "31-Oct-25",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 12,000,000",
    total: "IQD 12,000,000",
    status: "Unpaid"
  },
  {
    po: "4400013503",
    invoice_no: "CP-INV-D-00007",
    date: "Nov-25",
    description: "Generators rental: 2x 150KVA, including operators available 24/7 and a 5000-liter fuel tank.",
    duration_from: "01-Oct-25",
    duration_to: "31-Oct-25",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 12,000,000",
    total: "IQD 12,000,000",
    status: "Unpaid"
  },
  {
    po: "4400013503",
    invoice_no: "CP-INV-D-00008",
    date: "Dec-25",
    description: "Generators rental: 2x 150KVA, including operators available 24/7 and a 5000-liter fuel tank.",
    duration_from: "01-Oct-25",
    duration_to: "31-Oct-25",
    unit: "Lot",
    qty: 1,
    invoice_amount: "IQD 12,000,000",
    total: "IQD 12,000,000",
    status: "Unpaid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00002",
    date: "05-Mar-24",
    description: "Diesel Fuel for Generators POD 4",
    duration_from: "05-Mar-24",
    duration_to: "05-Mar-24",
    unit: "Liters",
    qty: 2890,
    invoice_amount: "IQD 750",
    total: "IQD 2,167,500",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00002",
    date: "24-Apr-24",
    description: "Diesel Fuel for Generators POD 6",
    duration_from: "24-Apr-24",
    duration_to: "24-Apr-24",
    unit: "Liters",
    qty: 1100,
    invoice_amount: "IQD 750",
    total: "IQD 825,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00002",
    date: "30-Jun-24",
    description: "Diesel Fuel for Generators POD 7",
    duration_from: "30-Jun-24",
    duration_to: "30-Jun-24",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00002",
    date: "30-Jun-24",
    description: "Diesel Fuel for Generators POD 8",
    duration_from: "30-Jun-24",
    duration_to: "30-Jun-24",
    unit: "Liters",
    qty: 2000,
    invoice_amount: "IQD 750",
    total: "IQD 1,500,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00002",
    date: "18-Jul-24",
    description: "Diesel Fuel for Generators POD 9",
    duration_from: "18-Jul-24",
    duration_to: "18-Jul-24",
    unit: "Liters",
    qty: 2100,
    invoice_amount: "IQD 750",
    total: "IQD 1,575,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00007",
    date: "16-Aug-24",
    description: "Diesel Fuel for Generators POD 10",
    duration_from: "16-Aug-24",
    duration_to: "16-Aug-24",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00007",
    date: "28-Aug-24",
    description: "Diesel Fuel for Generators POD 14",
    duration_from: "28-Aug-24",
    duration_to: "28-Aug-24",
    unit: "Liters",
    qty: 2000,
    invoice_amount: "IQD 750",
    total: "IQD 1,500,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00008",
    date: "17-Sep-24",
    description: "Diesel Fuel for Generators POD 15",
    duration_from: "17-Sep-24",
    duration_to: "17-Sep-24",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00008",
    date: "29-Sep-24",
    description: "Diesel Fuel for Generators POD 17",
    duration_from: "29-Sep-24",
    duration_to: "29-Sep-24",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00008",
    date: "05-Oct-24",
    description: "Diesel Fuel for Generators POD 18",
    duration_from: "05-Oct-24",
    duration_to: "05-Oct-24",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00011",
    date: "20-Oct-24",
    description: "Diesel Fuel for Generators POD 19",
    duration_from: "20-Oct-24",
    duration_to: "20-Oct-24",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00011",
    date: "11-Nov-24",
    description: "Diesel Fuel for Generators POD 20",
    duration_from: "11-Nov-24",
    duration_to: "11-Nov-24",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00011",
    date: "18-Nov-24",
    description: "Diesel Fuel for Generators POD 22",
    duration_from: "18-Nov-24",
    duration_to: "18-Nov-24",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00011",
    date: "12-Dec-24",
    description: "Diesel Fuel for Generators POD 23",
    duration_from: "12-Dec-24",
    duration_to: "12-Dec-24",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00014",
    date: "05-Jan-25",
    description: "Diesel Fuel for Generators POD 24",
    duration_from: "05-Jan-25",
    duration_to: "05-Jan-25",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00014",
    date: "28-Jan-25",
    description: "Diesel Fuel for Generators POD 25",
    duration_from: "28-Jan-25",
    duration_to: "28-Jan-25",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00014",
    date: "01-Feb-25",
    description: "Diesel Fuel for Generators POD 28",
    duration_from: "01-Feb-25",
    duration_to: "01-Feb-25",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00014",
    date: "01-Jan-25",
    description: "Diesel Fuel for Generators POD 29",
    duration_from: "01-Jan-25",
    duration_to: "01-Jan-25",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00014",
    date: "12-Mar-25",
    description: "Diesel Fuel for Generators POD 31",
    duration_from: "12-Mar-25",
    duration_to: "12-Mar-25",
    unit: "Liters",
    qty: 2000,
    invoice_amount: "IQD 750",
    total: "IQD 1,500,000",
    status: "Paid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00017",
    date: "09-Jun-25",
    description: "Diesel Fuel for Generators POD 32",
    duration_from: "09-Jun-25",
    duration_to: "09-Jun-25",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Unpaid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00017",
    date: "13-Jun-25",
    description: "Diesel Fuel for Generators POD 33",
    duration_from: "13-Jun-25",
    duration_to: "13-Jun-25",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Unpaid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00017",
    date: "02-Jun-25",
    description: "Diesel Fuel for Generators POD 34",
    duration_from: "02-Jun-25",
    duration_to: "02-Jun-25",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Unpaid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00019",
    date: "20-Jun-25",
    description: "Diesel Fuel for Generators POD 35",
    duration_from: "20-Jun-25",
    duration_to: "20-Jun-25",
    unit: "Liters",
    qty: 2000,
    invoice_amount: "IQD 750",
    total: "IQD 1,500,000",
    status: "Unpaid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00019",
    date: "09-Jul-25",
    description: "Diesel Fuel for Generators POD 36",
    duration_from: "09-Jul-25",
    duration_to: "09-Jul-25",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Unpaid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00019",
    date: "19-Jul-25",
    description: "Diesel Fuel for Generators POD 37",
    duration_from: "19-Jul-25",
    duration_to: "19-Jul-25",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Unpaid"
  },
  {
    po: "PO00023",
    invoice_no: "CP-INV00019",
    date: "24-Jul-25",
    description: "Diesel Fuel for Generators POD 38",
    duration_from: "24-Jul-25",
    duration_to: "24-Jul-25",
    unit: "Liters",
    qty: 1000,
    invoice_amount: "IQD 750",
    total: "IQD 750,000",
    status: "Unpaid"
  }
];

// =======================
// 2) حفظ ملف JSON
// =======================

const jsonPath = path.join(__dirname, 'invoices_seed.json');
fs.writeFileSync(jsonPath, JSON.stringify(invoices, null, 2), 'utf8');
console.log('✓ تم حفظ ملف JSON:', jsonPath);

// =======================
// 3) إعداد قاعدة البيانات
// =======================

const dbPath = path.join(__dirname, 'invoices.db');
const db = new sqlite3.Database(dbPath);

// تحويل نص المبلغ إلى رقم
function parseMoney(value) {
  if (value === null || value === undefined) return 0;
  if (typeof value === 'number') return value;
  return (
    Number(
      String(value)
        .replace(/IQD/gi, '')
        .replace(/,/g, '')
        .trim()
    ) || 0
  );
}

db.serialize(() => {
  db.run(`
    CREATE TABLE IF NOT EXISTS invoices (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      no INTEGER,
      po TEXT NOT NULL,
      invoice_no TEXT NOT NULL,
      date TEXT NOT NULL,
      description TEXT NOT NULL,
      duration_from TEXT NOT NULL,
      duration_to TEXT NOT NULL,
      unit TEXT NOT NULL,
      qty REAL NOT NULL,
      invoice_amount REAL NOT NULL,
      total REAL NOT NULL,
      status TEXT NOT NULL
    )
  `);

  const insertSql = `
    INSERT INTO invoices (
      no, po, invoice_no, date, description,
      duration_from, duration_to, unit, qty,
      invoice_amount, total, status
    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
  `;

  const stmt = db.prepare(insertSql);

  let paidTotal = 0;
  let unpaidTotal = 0;

  invoices.forEach((row, index) => {
    const qty = Number(row.qty);
    const invoiceAmount = parseMoney(row.invoice_amount);
    const total = parseMoney(row.total);

    if (String(row.status).toLowerCase().startsWith('paid')) {
      paidTotal += total;
    } else {
      unpaidTotal += total;
    }

    stmt.run(
      index + 1, // no
      row.po,
      row.invoice_no,
      row.date,
      row.description,
      row.duration_from,
      row.duration_to,
      row.unit,
      qty,
      invoiceAmount,
      total,
      row.status
    );
  });

  stmt.finalize(err => {
    if (err) {
      console.error('✗ خطأ في إدخال البيانات:', err);
      db.close();
      return;
    }

    console.log('✓ تم استيراد جميع الفواتير إلى قاعدة البيانات:', dbPath);
    console.log('---------------------------------------------');
    console.log(
      'إجمالي المبالغ المدفوعة (Paid):',
      paidTotal.toLocaleString('en-US'),
      'IQD'
    );
    console.log(
      'إجمالي المبالغ غير المدفوعة (Unpaid + Un-Paid):',
      unpaidTotal.toLocaleString('en-US'),
      'IQD'
    );
    console.log('---------------------------------------------');

    db.close();
  });
});
