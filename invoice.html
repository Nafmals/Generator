function exportCsv(){
  if(!invoices.length){ alert("لا توجد فواتير لتصديرها."); return; }
  const header = ["Invoice No","Issue Date","Due Date","Customer","Contract","Status","Balance (IQD)","Note"];
  const lines = [header.join(",")];
  invoices.forEach(inv=>{
    const statusTxt = inv.status==="paid" ? "PAID" :
                      inv.status==="unpaid" ? (isOverdue(inv)?"OVERDUE":"UNPAID") :
                      "DRAFT";
    const row = [
      `"${(inv.number||"").replace(/"/g,'""')}"`,
      `"${(inv.issueDate||"").replace(/"/g,'""')}"`,
      `"${(inv.dueDate||"").replace(/"/g,'""')}"`,
      `"${(inv.customerName||"").replace(/"/g,'""')}"`,
      `"${(inv.contract||"").replace(/"/g,'""')}"`,
      `"${statusTxt}"`,
      inv.balance != null ? inv.balance : 0,
      `"${(inv.note||"").replace(/"/g,'""')}"`
    ];
    lines.push(row.join(","));
  });
  const blob = new Blob(["\ufeff"+lines.join("\n")],{type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "invoices-report.csv";
  a.click();
  URL.revokeObjectURL(url);
}
